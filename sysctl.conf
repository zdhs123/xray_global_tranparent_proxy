#
# /etc/sysctl.conf - Configuration file for setting system variables
# See /etc/sysctl.d/ for additional system variables.
# See sysctl.conf (5) for information.
#

#kernel.domainname = example.com

# Uncomment the following to stop low-level messages on console
#kernel.printk = 3 4 1 3

###################################################################
# Functions previously found in netbase
#

# Uncomment the next two lines to enable Spoof protection (reverse-path filter)
# Turn on Source Address Verification in all interfaces to
# prevent some spoofing attacks
#net.ipv4.conf.default.rp_filter=1
#net.ipv4.conf.all.rp_filter=1

# Uncomment the next line to enable TCP/IP SYN cookies
# See http://lwn.net/Articles/277146/
# Note: This may impact IPv6 TCP sessions too
#net.ipv4.tcp_syncookies=1

# Uncomment the next line to enable packet forwarding for IPv4
net.ipv4.ip_forward=1

# Uncomment the next line to enable packet forwarding for IPv6
#  Enabling this option disables Stateless Address Autoconfiguration
#  based on Router Advertisements for this host
net.ipv6.conf.all.forwarding=1


###################################################################
# Additional settings - these settings can improve the network
# security of the host and prevent against some network attacks
# including spoofing attacks and man in the middle attacks through
# redirection. Some network environments, however, require that these
# settings are disabled so review and enable them as needed.
#
# Do not accept ICMP redirects (prevent MITM attacks)
#net.ipv4.conf.all.accept_redirects = 0
#net.ipv6.conf.all.accept_redirects = 0
# _or_
# Accept ICMP redirects only for gateways listed in our default
# gateway list (enabled by default)
# net.ipv4.conf.all.secure_redirects = 1
#
# Do not send ICMP redirects (we are not a router)
#net.ipv4.conf.all.send_redirects = 0
#
# Do not accept IP source route packets (we are not a router)
#net.ipv4.conf.all.accept_source_route = 0
#net.ipv6.conf.all.accept_source_route = 0
#
# Log Martian Packets
#net.ipv4.conf.all.log_martians = 1
#

###################################################################
# Magic system request Key
# 0=disable, 1=enable all, >1 bitmask of sysrq functions
# See https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html
# for what other values do
#kernel.sysrq=438


net.nf_conntrack_max = 65535
net.netfilter.nf_conntrack_max = 65535

### 系统中所允许的文件句柄的最大数目
fs.file-max = 65535 #2G内存设置为65535，初始值12553500
### 单个进程所允许的文件句柄的最大数目
fs.nr_open = 65535 #2G内存设置为65535，初始值12553500
### 内核允许使用的共享内存大 Controls the maximum number of shared memory segments, in pages
kernel.shmall = 4294967296
###单个共享内存段的最大值 Controls the maximum shared segment size, in bytes
kernel.shmmax = 68719476736
### 内核中消息队列中消息的最大值 Controls the maximum size of a message, in bytes
kernel.msgmax = 65536
### 系统救援工具
kernel.sysrq = 0
### 在每个网络接口接收数据包的速率比内核处理这些包的速率快时&#xff0c;允许送到缓存队列的数据包的最大数目
net.core.netdev_max_backlog = 2000000
### 默认的TCP数据接收窗口大小&#xff08;字节&#xff09;
net.core.rmem_default = 699040
### 最大的TCP数据接收窗口&#xff08;字节&#xff09;
net.core.rmem_max = 50331648
### 默认的TCP数据发送窗口大小&#xff08;字节&#xff09;
net.core.wmem_default = 131072
### 最大的TCP数据发送窗口&#xff08;字节&#xff09;
net.core.wmem_max = 33554432
### 定义了系统中每一个端口最大的监听队列的长度&#xff0c;这是个全局的参数
net.core.somaxconn = 65535

### TCP/UDP协议允许使用的本地端口号
net.ipv4.ip_local_port_range = 15000 65000
net.ipv4.ip_nonlocal_bind = 1
### 对于本端断开的socket连接&#xff0c;TCP保持在FIN-WAIT-2状态的时间&#xff08;秒&#xff09;
net.ipv4.tcp_fin_timeout = 7
### TCP发送keepalive探测消息的间隔时间&#xff08;秒&#xff09;&#xff0c;用于确认TCP连接是否有效
net.ipv4.tcp_keepalive_time = 300
net.ipv4.tcp_max_orphans = 3276800
### 对于还未获得对方确认的连接请求&#xff0c;可保存在队列中的最大数目
net.ipv4.tcp_max_syn_backlog = 655360
net.ipv4.tcp_max_tw_buckets = 6000000
### 确定TCP栈应该如何反映内存使用&#xff0c;每个值的单位都是内存页&#xff08;通常是4KB&#xff09;
### 第一个值是内存使用的下限&#xff1b;第二个值是内存压力模式开始对缓冲区使用应用压力的上限&#xff1b;第三个值是内存使用的上限.
net.ipv4.tcp_mem = 94500000 915000000 927000000
### 为自动调优定义socket使用的内存。
### 第一个值是为socket接收缓冲区分配的最少字节数&#xff1b;
### 第二个值是默认值&#xff08;该值会被rmem_default覆盖&#xff09;&#xff0c;缓冲区在系统负载不重的情况下可以增长到这个值&#xff1b;
### 第三个值是接收缓冲区空间的最大字节数&#xff08;该值会被rmem_max覆盖&#xff09;
net.ipv4.tcp_rmem = 32768 699040 50331648
### 为自动调优定义socket使用的内存。
### 第一个值是为socket发送缓冲区分配的最少字节数&#xff1b;
### 第二个值是默认值&#xff08;该值会被wmem_default覆盖&#xff09;&#xff0c;缓冲区在系统负载不重的情况下可以增长到这个值&#xff1b;
### 第三个值是发送缓冲区空间的最大字节数&#xff08;该值会被wmem_max覆盖&#xff09;
net.ipv4.tcp_wmem = 32768 131072 33554432
net.ipv4.tcp_slow_start_after_idle = 0
net.ipv4.tcp_synack_retries = 2
### 表示是否打开TCP同步标签&#xff08;syncookie&#xff09;&#xff0c;同步标签可以防止一个套接字在有过多试图连接到达时引起过载
### 内核必须打开了CONFIG_SYN_COOKIES项进行编译&#xff0c;
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_syn_retries = 2
### 表示开启TCP连接中TIME-WAIT sockets的快速回收&#xff0c;默认为0&#xff0c;表示关闭
net.ipv4.tcp_tw_recycle = 1
### 允许将TIME-WAIT sockets重新用于新的TCP连接&#xff0c;默认为0&#xff0c;表示关闭
net.ipv4.tcp_tw_reuse = 1
### 启用RFC 1323定义的window scaling&#xff0c;要支持超过64KB的TCP窗口&#xff0c;必须启用该值&#xff08;1表示启用&#xff09;&#xff0c;
### TCP窗口最大至1GB&#xff0c;TCP连接双方都启用时才生效&#xff0c;默认为1
net.ipv4.tcp_window_scaling = 1
### 最大限度使用物理内存
vm.swappiness = 0
  
net.ipv4.ip_local_port_range  = 1025 65534
 
net.ipv4.tcp_max_syn_backlog = 100000
net.core.netdev_max_backlog = 100000

net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.core.somaxconn = 65534

 
net.ipv4.tcp_fin_timeout = 10
net.ipv4.tcp_syncookies = 0
 

# memory allocation min/pressure/max.
# read buffer, write buffer, and buffer space
net.ipv4.tcp_rmem = 10000000 10000000 10000000
net.ipv4.tcp_wmem = 10000000 10000000 10000000
net.ipv4.tcp_mem = 10000000 10000000 10000000
 
net.core.rmem_max = 11960320
net.core.wmem_max = 11960320
net.core.rmem_default = 11960320
net.core.wmem_default = 11960320
net.core.optmem_max = 11960320
net.core.netdev_max_backlog = 300000
 
# turn off selective ACK and timestamps
net.ipv4.tcp_sack = 0
net.ipv4.tcp_timestamps = 0
 
#默认情况下&#xff0c;此参数为1&#xff0c;将大幅削减空闲连接时的CWnd&#xff0c;对长连接如SSL产生负面影响。将其设置为0&#xff0c;可以显著提高性能。
